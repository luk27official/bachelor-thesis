\chapter{User documentation}
\label{chap:user_docs}

\xxx{TODO: add motivation for users, distinguish between a regular user and a developer}

\section{Deployment}
\label{sec:deployment}

This section describes how to deploy the application. The preffered way is to deploy PrankWeb using Docker. Local development and deployment is limited.

\subsection{Docker deployment}
\label{subsec:docker_deployment}

Firstly, Docker and Docker Compose need to be installed\footnote{Downloadable from the official website at \url{https://docs.docker.com/get-docker/}}. 

After installing Docker, the PrankWeb repository needs to be cloned, preferrably using Git\footnote{Downloadable from the official website at \url{https://git-scm.com/downloads}}.

\begin{enumerate}
    \item Create a directory for the PrankWeb repository and navigate to it.
    \item Clone the repository using the following command:
    \xxx{todo: remove the green font}
    \begin{lstlisting}
        git clone https://github.com/cusbg/prankweb.git .
    \end{lstlisting}
    \item Create directories for each of the volumes.
    \item Create mounts for each of the volumes in the \texttt{docker-compose.yml} file. The mounts are created as follows, simply update the \texttt{/tmp/} paths to the paths of the directories created in the previous step:
    \begin{lstlisting}
        docker volume create --name prankweb_rabbitmq --opt type=none --opt device=/tmp/rabbitmq --opt o=bind

        docker volume create --name prankweb_conservation --opt type=none --opt device=/tmp/conservation --opt o=bind

        docker volume create --name prankweb_predictions --opt type=none --opt device=/tmp/predictions --opt o=bind

        docker volume create --name prankweb_services --opt type=none --opt device=/tmp/services --opt o=bind
    \end{lstlisting}
    \xxx{TODO: maybe add docking}
    \item Optionally, create a \texttt{.env} file to change the default variables defined in the \texttt{docker-compose.yml} file. Notice that UID and GID need to have write permissions to the directories created in the previous steps.
    \item Build the Docker images using the following command:
    \begin{lstlisting}
        docker-compose build
    \end{lstlisting}
    \item Optionally, download the conservation database (keep in mind that this database is large, around 30 GB):
    \begin{lstlisting}
        docker-compose run --rm executor python3 /opt/hmm-based-conservation/download_database.py
    \end{lstlisting}
    \item Start the containers using the following command:
    \begin{lstlisting}
        docker-compose up
    \end{lstlisting}
\end{enumerate}

The application is now be accessible at \url{http://localhost:8020/}.

Although the main deployment process will not change much, the best way to get the current information is to refer to the official documentation at \url{https://github.com/cusbg/p2rank-framework/wiki/PrankWeb-deploy-with-Docker}.

\subsection{Local deployment}
\label{subsec:local_deployment}

The local deployment is not recommended, as the support for some components is limited.

The only component that is developed better locally is the frontend (when not considering backend API changes). To run the frontend locally, firstly clone the repository as described in \ref{subsec:docker_deployment}. Then, navigate to the \texttt{frontend} directory.

It is recommended to have a look at the \texttt{server/configuration.js} file to set up the proxy server that will serve potential calls. The proxy service should be running, it is possible to use the default PrankWeb website at \url{https://prankweb.cz}.

This is the default configuration:
\begin{lstlisting}
    // This configuration is used only in develop mode.
    module.exports = {
        // Port used to run-develop instance.
        "port": 8075,
        // Use this to server data from files. Thus, you can develop
        // frontend without the need to run another component.
        //"proxy-directory": "../../data/database/",
        // Use the option bellow to proxy commands to task runner instance.
        // This allows you to run tasks or connect to existing instance (https://prankweb.cz).
        "proxy-service": "https://prankweb.cz",
    }
\end{lstlisting}

After setting up the proxy server, the frontend npm modules need to be installed. This can be done using the following command:
\begin{lstlisting}
    npm ci
\end{lstlisting}

Then, it is possible to run the frontend using the following command:
\begin{lstlisting}
    npm run dev
\end{lstlisting}

The frontend is now accessible at \url{http://localhost:8075/} (with the port specified in the configuration file).

Some of the tools from the executors like P2Rank may work from the command line as used in the Python scripts or Dockerfiles, for more information refer to those.

Official documentation for the local deployment is available at \url{https://github.com/cusbg/p2rank-framework/wiki/PrankWeb-deploy-for-development}.


\section{Regular user}
\label{sec:regular_user}
\xxx{TODO: add some screenshots and a brief description of the UI}

\section{Developer}
\label{sec:developer}
\xxx{TODO: add a brief description on how to add new client/server side tasks, change the current visuals etc.}
